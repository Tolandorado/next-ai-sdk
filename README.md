# ChatGPT Lite — Excel Assistant

Chat GPT Lite с custom tools для EXcel. Проект позволяет общаться с AI, который умеет читать, анализировать и редактировать данные в XLSX-файлах с использованием механизма Tool Calling.

## Стек технологий

- **Framework:** Next.js 16 (App Router, TypeScript)
- **Runtime & DB:** Bun + `bun:sqlite` (автоматическая инициализация при запуске)
- **AI Integration:** Vercel AI SDK (`ai`, `@ai-sdk/openai`)
- **Styling:** Tailwind CSS 4
- **Excel Logic:** `xlsx` (SheetJS) для парсинга и записи файлов

## Подготовка окружения

1. Установите **Bun** (инструкции на bun.sh).
2. В корневой директории проекта создайте папку `data`, если она еще не существует, добавьте в нее excel файл с таблицей.
3. Перейдите в директорию фронтенда:
   ```bash
   cd frontend
   ```
4. Настройте переменные окружения. Создайте файл `.env` на основе env.example:
   ```bash
   cp env.example .env
   ```

### Переменные окружения:
- `OPENAI_API_KEY`: Ваш ключ OpenAI API.
- `DATABASE_PATH`: Путь к файлу базы данных SQLite (по умолчанию `./data/chat.db`).
- `XLSX_FILE_PATH`: Путь к рабочему Excel-файлу (по умолчанию `./data/example.xlsx`).
- `NEXT_PUBLIC_DEFAULT_SHEET`: Лист по умолчанию (например, `Sheet1`).
- `NEXT_PUBLIC_DEFAULT_FROM` / `NEXT_PUBLIC_DEFAULT_TO`: Диапазон для начального отображения (например, `A1` / `C3`).

## Запуск

```bash
bun install
bun --bun run dev
```
Приложение будет доступно по адресу `http://localhost:3000`. База данных и необходимые папки будут созданы автоматически при первом обращении.

## Основные возможности

*   **Чат с ИИ-помощником**: Интерактивный чат с возможностью создания и управления несколькими тредами.
*   **Работа с XLSX-файлами**: Функциональность для взаимодействия с данными в формате Excel, включая:
    *   Обновление диапазонов ячеек.
    *   Изменение отдельных ячеек.
    *   Подтверждение операций через модальные окна.
    *   Объяснение формул и выражений в ячейках.
*   **Отображение и управление данными**: Представление данных в табличном виде с возможностью интерактивного взаимодействия.
*   **API-интерфейсы**: Набор API для управления чатом, сообщениями, тредами и операциями с XLSX.

## Что успел реализовать

*   Полная функциональность управления тредами: создание, выбор, просмотр списка и удаление тредов.
*   Сохранение истории сообщений (пользовательских и ассистента) в базе данных SQLite, привязанных к соответствующим тредам.
*   Реализованы инструменты для работы с XLSX: `getRange` (чтение диапазона), `explainFormula` (объяснение формулы), `confirmCellUpdate` (подтверждение обновления ячейки), `confirmRangeUpdate` (подтверждение обновления диапазона), `executeCellUpdate` (выполнение обновления ячейки), `executeRangeUpdate` (выполнение обновления диапазона).
*   Поддержка работы с заранее подготовленным XLSX-файлом (по умолчанию `./data/example.xlsx`, путь настраивается через `XLSX_FILE_PATH`). Если файл отсутствует, создается новый с образцом данных.
*   В модальном окне таблицы пользователь может выделить диапазон ячеек и "сохранить" его как упоминание (например, `@Sheet1!A1:B3`), которое затем вставляется в поле ввода чата.

## Ограничения/Баги

*   Не отображается ответ нейросети на первый промпт(если не выбран тред), так как messages не передает его(Сам ответ есть в EventStream/Response, соответственно рестарт страницы отрисовывает его)
*   Нет защиты от параллельной работы с xlsx таблицей
*   У сообщений, представляющих результат обновления таблицы в бд не сохраняется как таковой статус, из-за чего подтягиваемые из бд(Например после рестарта страницы) сообщения-результаты не имеют функционала(открытия модального окна по клику)
*   Модальное окно по кнопке "Открыть таблицу" не синхронизируется с актуальными данными после изменений
